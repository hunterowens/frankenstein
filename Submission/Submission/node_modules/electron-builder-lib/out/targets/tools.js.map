{"version":3,"file":"tools.js","sourceRoot":"","sources":["../../src/targets/tools.ts"],"names":[],"mappings":"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","sourcesContent":["import BluebirdPromise from \"bluebird-lst\"\nimport { isEnvTrue } from \"builder-util\"\nimport { getBin, getBinFromGithub } from \"builder-util/out/binDownload\"\nimport { Lazy } from \"lazy-val\"\nimport * as path from \"path\"\nimport { Platform } from \"../core\"\n\nexport function getLinuxToolsPath() {\n  //noinspection SpellCheckingInspection\n  return getBinFromGithub(\"linux-tools\", \"mac-10.12.3\", \"SQ8fqIRVXuQVWnVgaMTDWyf2TLAJjJYw3tRSqQJECmgF6qdM7Kogfa6KD49RbGzzMYIFca9Uw3MdsxzOPRWcYw==\")\n}\n\nexport function getAppImage() {\n  //noinspection SpellCheckingInspection\n  return getBinFromGithub(\"appimage\", \"9.0.4\", \"pTFOnybYI2iGAyDUgXjzTkfuQ/E2ux8uLI1lXGB0RDoKhvFEq3y+q0sFzMOsbPTKZCcBRGhTujRlnsnTwgJmyw==\")\n}\n\nexport const fpmPath = new Lazy(() => {\n  if (process.platform === \"win32\" || process.env.USE_SYSTEM_FPM === \"true\") {\n    return BluebirdPromise.resolve(\"fpm\")\n  }\n\n  const osAndArch = process.platform === \"darwin\" ? \"mac\" : `linux-x86${process.arch === \"ia32\" ? \"\" : \"_64\"}`\n\n  if (process.platform === \"darwin\") {\n    //noinspection SpellCheckingInspection\n    return getBinFromGithub(\"fpm\", \"1.9.2.1-20150715-2.2.2-mac\", \"6sZZoRKkxdmv3a6E5dnZgVl23apGnImhDtGHKhgCE1WOtXBUJnx+w0WvB2HD2/sitz4f93Mf7+QqDCIbfP7LOw==\")\n      .then(it => path.join(it, \"fpm\"))\n  }\n\n  //noinspection SpellCheckingInspection\n  const checksum = process.arch === \"ia32\" ? \"cTT/HdjrQ6qTJQhTZaZC3lyDkRCyNFtNBZ0F7n6mh5B3YmD5ttJZ0xn65pQS03dhEi67A8K1xXNO+tyEEviiIg==\" : \"0zKxWlHuQEUsXJpWll5Bc4OTI8d0jcMVlme9OeHI+Y+s3sv1S4KyGLOEVEkNw6pRU8F+A1Dj5IR95/+U8YzB0A==\"\n  return getBinFromGithub(\"fpm\", `1.9.2-2.3.1-${osAndArch}`, checksum)\n    .then(it => path.join(it, \"fpm\"))\n})\n\n// noinspection JSUnusedGlobalSymbols\nexport function prefetchBuildTools() {\n  // yes, we starting to use native Promise\n  return Promise.all([getAppImage(), fpmPath.value, getAppBuilderTool()])\n}\n\nexport function getZstd() {\n  // noinspection SpellCheckingInspection\n  return getTool({\n    name: \"zstd\",\n    version: \"1.3.3\",\n    mac: \"RnFYU+gEieQFCu943WEmh++PT5TZjDSqSCZvZj7ArfVkc+JS+DdGi30/466gqx9VFKsk6XpYrCpZNryFSvDOuw==\",\n    \"linux-x64\": \"M1YpBtWX9C99hwRHF8bOLdN5bUFChMwWRc/NzGSwG48VVtegEV2RCFqbT1v0ZcSLC54muhOtK1VgMEmTKr0ouQ==\",\n    \"win-ia32\": \"uUG8l+JQZtgFOq5G9lg3ryABiFA2gv14inJTAmpprywmbVfCVe++ikzJcjg5ZdLKhYDcB3nIsKE5c7pWY7+1yA==\",\n    \"win-x64\": \"lBCx8nuRkEu8oQqgXosuO9e35BQOSyugFaK5ExBiTKh6qkv6amsYEUNELZGmEqH+FXscagxq+7+QUYkWJfmROQ==\",\n  })\n}\n\nexport function getAria() {\n  const platform = Platform.current()\n  const archQualifier = platform === Platform.MAC ? \"\" : `-${process.arch}`\n\n  let checksum = \"\"\n  if (platform === Platform.MAC) {\n    // noinspection SpellCheckingInspection\n    checksum = \"UjstpQUAtoP/sZ9SNuWwIN1WyDfvr1V3bzLGzTZCt1IqQsf9YwBSo0jrXMMRZOqv1sy5EOvp5nyC4VvJZCRVuQ==\"\n  }\n  else if (platform === Platform.WINDOWS) {\n    // noinspection SpellCheckingInspection\n    checksum = process.arch === \"ia32\" ?\n      \"aulZig14OCHqj5qUWDvIAacibzW9k+gfDGDeECzWDrF7FPYzI+Vn7Q7QnW/FXNyNnbe8PeYawTlGzD3vJxLQWg==\" :\n      \"zksKH0Uazwtc/vfGSVy+tzsNou+thSamAGTKt8P1DLoNkdSz9ueaIFoJ7jt8jlDds8Z6Rrxls6IFkZRBDxiyfg==\"\n  }\n\n  //noinspection SpellCheckingInspection\n  return getBinFromGithub(`aria2-${platform.buildConfigurationKey}${archQualifier}`, \"1.33.1\", checksum)\n    .then(it => path.join(it, `aria2c${platform === Platform.WINDOWS ? \".exe\" : \"\"}`))\n}\n\nexport interface ToolDescriptor {\n  name: string\n  version: string\n\n  repository?: string\n\n  mac: string\n  \"linux-ia32\"?: string\n  \"linux-x64\"?: string\n  \"linux-armV7\"?: string\n  \"linux-armV8\"?: string\n\n  \"win-ia32\": string\n  \"win-x64\": string\n}\n\nexport function getTool(descriptor: ToolDescriptor): Promise<string> {\n  const platform = Platform.current()\n  const checksum = platform === Platform.MAC ? descriptor.mac : (descriptor as any)[`${platform.buildConfigurationKey}-${process.arch}`]\n  if (checksum == null) {\n    throw new Error(`Checksum not specified for ${platform}:${process.arch}`)\n  }\n\n  let archQualifier = platform === Platform.MAC ? \"\" : `-${process.arch}`\n  if (archQualifier === \"arm\") {\n    archQualifier = \"armv7\"\n  }\n  else if (archQualifier === \"arm64\") {\n    archQualifier = \"armv8\"\n  }\n\n  // https://github.com/develar/block-map-builder/releases/download/v0.0.1/block-map-builder-v0.0.1-win-x64.7z\n  const version = descriptor.version\n  const name = descriptor.name\n  const repository = descriptor.repository || \"electron-userland/electron-builder-binaries\"\n  const tagPrefix = descriptor.repository == null ? `${name}-` : \"v\"\n  return getBin(name, `${name}-v${version}-${process.arch}`, `https://github.com/${repository}/releases/download/${tagPrefix}${version}/${name}-v${version}-${platform.buildConfigurationKey}${archQualifier}.7z`, checksum)\n    .then(it => path.join(it, `${name}${platform === Platform.WINDOWS ? \".exe\" : \"\"}`))\n}\n\nexport function getAppBuilderTool() {\n  if (isEnvTrue(process.env.USE_SYSTEM_AB)) {\n    return Promise.resolve(\"app-builder\")\n  }\n\n  // noinspection SpellCheckingInspection\n  return getTool({\n    repository: \"develar/app-builder\",\n    name: \"app-builder\",\n    version: \"0.6.0\",\n    mac: \"d27p1TYhPVlWFS+3TO8dh80sHP5imMnZTS04ODvL9xHpCQ7KZEUqFEWYi7zDFXKfzBU6zwBcRGrb8BwQAawvzg==\",\n    \"linux-ia32\": \"1aLAsDliV/kCYfOQR/NX43pRwO/v4nC7F98Z9ZRO8r8iXEpTLYVJC19FNup81WpD0hvxLBspnbq73YiSE3aX8g==\",\n    \"linux-x64\": \"6iu/0BzEKTIuCZ/pVPorpLTXjTzqcquTfrlyB9mEyPXQcHPTueK+tBBDQ6SIO7eaGq+W3PDe1oEjgiz2q3Zd4g==\",\n    \"linux-armV7\": \"zUxn5fAxeGylF7mqVP+Aaas3vD3ITTS26EBty9VkGz51EYgCVYnQVTacDIQjwB6s1zit6jt8EJy5Jj0Y+6U+7w==\",\n    \"linux-armV8\": \"69napXVwaPqQcNp7tozNyo7VJbB90E2RToN0pqGppdfUBzTLJUNnZL5D7H4MoUUPS/WgNRalEswb7GfZOsK4XA==\",\n    \"win-ia32\": \"HW+pZS96d0v96iq0y8BX4vg5J97oFMujPaqziatRNZif26EI75lS5S58qCEmooyr9lXDLwbIlNIhrKg7ZzlNhw==\",\n    \"win-x64\": \"eO8eJq2N/t0/3g3EuRut0LU460WUqzywiRhr+OjEUQH1Gt7GuIdc4gYOfDazYjyeTqlATCfT/OzQMdplaac2wQ==\",\n  })\n}"]}
